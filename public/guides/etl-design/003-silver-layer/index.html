<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>3. Silver 레이어 - Bronze를 분석 가능한 상태로 올린다 | Junho Lee | DataNexus 구축 과정</title><meta name=keywords content="etl,silver,data-cleaning"><meta name=description content="Bronze에 쌓아둔 원본 데이터를 정제하고 표준화한다. 타입을 맞추고, 컬럼명을 통일하고, 중복을 제거한다. dbt로 이 과정을 SQL 모델로 정의한다."><meta name=author content="Junho Lee"><link rel=canonical href=https://biz-agentic-ai.github.io/guides/etl-design/003-silver-layer/><link crossorigin=anonymous href=/assets/css/stylesheet.f02cd38532ee71bc47a8f72d7689b18efbda747f2e684f90cc6f2c90f2311a6b.css integrity="sha256-8CzThTLucbxHqPctdomxjvvadH8uaE+QzG8skPIxGms=" rel="preload stylesheet" as=style><link rel=icon href=https://biz-agentic-ai.github.io/favicon.svg><link rel=icon type=image/svg+xml sizes=16x16 href=https://biz-agentic-ai.github.io/favicon.svg><link rel=icon type=image/svg+xml sizes=32x32 href=https://biz-agentic-ai.github.io/favicon.svg><link rel=apple-touch-icon href=https://biz-agentic-ai.github.io/favicon.svg><link rel=mask-icon href=https://biz-agentic-ai.github.io/favicon.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://biz-agentic-ai.github.io/guides/etl-design/003-silver-layer/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=author content="Junho Lee"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@biz_agentic_ai"><meta name=twitter:creator content="@biz_agentic_ai"><meta name=googlebot content="index, follow"><meta name=bingbot content="index, follow"><meta name=slurp content="index, follow"><meta name=language content="ko"><meta name=geo.region content="KR"><meta name=geo.placename content="Seoul"><meta property="og:type" content="article"><meta property="og:site_name" content="Junho Lee | DataNexus 구축 과정"><meta property="og:locale" content="ko_KR"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"3. Silver 레이어 - Bronze를 분석 가능한 상태로 올린다","description":"Bronze에 쌓아둔 원본 데이터를 정제하고 표준화한다. 타입을 맞추고, 컬럼명을 통일하고, 중복을 제거한다. dbt로 이 과정을 SQL 모델로 정의한다.","image":"","author":{"@type":"Person","name":"Junho Lee"},"publisher":{"@type":"Organization","name":"Junho Lee | DataNexus 구축 과정","logo":{"@type":"ImageObject","url":"https:\/\/biz-agentic-ai.github.io\/favicon.svg"}},"datePublished":"2026-02-22T00:00:00Z","dateModified":"2026-02-22T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/biz-agentic-ai.github.io\/guides\/etl-design\/003-silver-layer\/"}}</script><style>:root{--sidebar-width:260px;--sidebar-bg:#1a1a2e;--sidebar-text:#e0e0e0;--sidebar-accent:#667eea;--sidebar-hover:rgba(102, 126, 234, 0.15);--sidebar-active-bg:linear-gradient(135deg, #667eea 0%, #764ba2 100%)}html{font-size:15px}.first-entry{min-height:240px}.first-entry .entry-header h1{font-size:24px}.first-entry .entry-content{font-size:14px}.home-info .entry-content{font-size:14px}.entry-header h2{font-size:20px}.entry-content{font-size:13px}.post-title,.post-single .post-title{font-size:26px}.post-content{font-size:15px;line-height:1.75}.post-content h1{font-size:24px}.post-content h2{font-size:21px}.post-content h3{font-size:18px}.post-content h4{font-size:16px}.post-meta{font-size:13px}.toc a{font-size:13px}.first-entry{margin-top:0}.sidebar{position:fixed;top:0;left:0;width:var(--sidebar-width);height:100vh;background:var(--sidebar-bg);color:var(--sidebar-text);z-index:100;overflow-y:auto;transition:transform .3s ease}.sidebar-inner{display:flex;flex-direction:column;height:100%;padding:24px 0}.sidebar-header{padding:0 20px 20px;border-bottom:1px solid rgba(255,255,255,8%);margin-bottom:8px}.sidebar-logo{display:flex;align-items:center;gap:8px;font-size:1.3rem;font-weight:700;color:#fff;text-decoration:none;letter-spacing:-.02em}.sidebar-logo-img{width:28px;height:28px;border-radius:6px;object-fit:cover}.home-logo-img{width:42px;height:42px;border-radius:8px;object-fit:cover;vertical-align:middle;margin-right:8px}.sidebar-logo:hover{opacity:.85}.sidebar-subtitle{display:block;font-size:.75rem;color:rgba(255,255,255,.4);margin-top:2px;letter-spacing:.02em}.sidebar-section ul{list-style:none;padding:0;margin:0}.sidebar-section li a{display:block;padding:9px 20px;color:var(--sidebar-text);text-decoration:none;font-size:.88rem;border-left:3px solid transparent;transition:all .2s}.sidebar-section li a:hover{background:var(--sidebar-hover);border-left-color:var(--sidebar-accent);color:#fff}.sidebar-section li a.active{color:var(--sidebar-accent);font-weight:600;border-left-color:var(--sidebar-accent)}.sidebar-section{padding:8px 0;border-top:1px solid rgba(255,255,255,8%);margin-top:4px}.sidebar-section-title{font-size:.7rem;text-transform:uppercase;letter-spacing:.08em;color:rgba(255,255,255,.4);padding:8px 20px;margin:0;font-weight:600}.sidebar-section li a{font-size:.82rem;padding:7px 20px;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.sidebar-stats{padding:10px 20px;border-top:1px solid rgba(255,255,255,8%);margin-top:4px;display:none;flex-direction:column;gap:6px}.sidebar-stat-pill{display:flex;align-items:center;gap:8px;padding:0 2px;height:28px}.stat-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}.stat-dot--pv{background:#667eea}.stat-dot--uv{background:#f5576c}.sidebar-stat-value{font-weight:600;font-size:.85rem;color:rgba(255,255,255,.9);font-variant-numeric:tabular-nums}.sidebar-stat-label{font-size:.7rem;color:rgba(255,255,255,.3)}.sidebar-dashboard-links{padding:8px 20px;display:none;flex-direction:column;gap:5px}.sidebar-dashboard-links.visible{display:flex}.sidebar-stats.visible{display:flex}.sidebar-dashboard-links a{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;font-size:.7rem;white-space:nowrap;color:rgba(255,255,255,.5);text-decoration:none;border:1px solid rgba(255,255,255,.1);border-radius:6px;transition:all .2s}.sidebar-dashboard-links a:hover{color:#fff;background:var(--sidebar-hover);border-color:var(--sidebar-accent)}.site-wrapper{margin-left:var(--sidebar-width);min-height:100vh}.sidebar-toggle{display:none;position:fixed;bottom:20px;left:20px;z-index:101;background:var(--sidebar-active-bg);color:#fff;border:none;border-radius:50%;width:48px;height:48px;cursor:pointer;box-shadow:0 4px 14px rgba(102,126,234,.4);align-items:center;justify-content:center;transition:transform .2s}.sidebar-toggle:hover{transform:scale(1.08)}.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:99;backdrop-filter:blur(2px)}@media(max-width:860px){.sidebar{transform:translateX(-100%)}.sidebar.open{transform:translateX(0)}.sidebar-toggle{display:flex}.sidebar-overlay.open{display:block}.site-wrapper{margin-left:0}}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-Q0RS9ZG67P"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Q0RS9ZG67P")}</script><meta property="og:url" content="https://biz-agentic-ai.github.io/guides/etl-design/003-silver-layer/"><meta property="og:site_name" content="Junho Lee | DataNexus 구축 과정"><meta property="og:title" content="3. Silver 레이어 - Bronze를 분석 가능한 상태로 올린다"><meta property="og:description" content="Bronze에 쌓아둔 원본 데이터를 정제하고 표준화한다. 타입을 맞추고, 컬럼명을 통일하고, 중복을 제거한다. dbt로 이 과정을 SQL 모델로 정의한다."><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="guides"><meta property="article:published_time" content="2026-02-22T00:00:00+00:00"><meta property="article:modified_time" content="2026-02-22T00:00:00+00:00"><meta property="article:tag" content="Etl"><meta property="article:tag" content="Silver"><meta property="article:tag" content="Data-Cleaning"><meta property="og:see_also" content="https://biz-agentic-ai.github.io/guides/etl-design/002-bronze-layer/"><meta property="og:see_also" content="https://biz-agentic-ai.github.io/guides/etl-design/001-medallion-architecture/"><meta property="og:see_also" content="https://biz-agentic-ai.github.io/guides/etl-design/004-scd/"><meta name=twitter:card content="summary"><meta name=twitter:title content="3. Silver 레이어 - Bronze를 분석 가능한 상태로 올린다"><meta name=twitter:description content="Bronze에 쌓아둔 원본 데이터를 정제하고 표준화한다. 타입을 맞추고, 컬럼명을 통일하고, 중복을 제거한다. dbt로 이 과정을 SQL 모델로 정의한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"기술 가이드","item":"https://biz-agentic-ai.github.io/guides/"},{"@type":"ListItem","position":2,"name":"ETL 설계","item":"https://biz-agentic-ai.github.io/guides/etl-design/"},{"@type":"ListItem","position":3,"name":"3. Silver 레이어 - Bronze를 분석 가능한 상태로 올린다","item":"https://biz-agentic-ai.github.io/guides/etl-design/003-silver-layer/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"3. Silver 레이어 - Bronze를 분석 가능한 상태로 올린다","name":"3. Silver 레이어 - Bronze를 분석 가능한 상태로 올린다","description":"Bronze에 쌓아둔 원본 데이터를 정제하고 표준화한다. 타입을 맞추고, 컬럼명을 통일하고, 중복을 제거한다. dbt로 이 과정을 SQL 모델로 정의한다.","keywords":["etl","silver","data-cleaning"],"articleBody":"\rGoogle Colab에서 실습하기\rBronze 데이터를 바로 쓰면 생기는 일 2편에서 Bronze에 원본을 있는 그대로 적재했다. 변환 없이. 그 원칙은 맞다. 문제는 Bronze 데이터가 분석에 쓸 수 있는 상태가 아니라는 것이다.\njaffle_shop의 bronze.orders를 보자. order_date 컬럼이 VARCHAR로 들어와 있다. 날짜 함수를 쓸 수 없다. status 컬럼에는 returned, return_pending, completed, placed, shipped가 섞여 있는데, 어느 값이 최종 상태인지 스키마만 봐서는 모른다.\nbronze.payments의 amount 컬럼은 센트 단위 정수다. 달러로 바꾸려면 100으로 나눠야 한다. 이걸 분석할 때마다 매번 나누는 건 실수를 부르는 구조다.\nSilver는 이런 문제를 한 번에 정리하는 레이어다. 타입을 맞추고, 컬럼명을 통일하고, 단위를 변환한다. 비즈니스 로직은 아직 넣지 않는다. “분석에 쓸 수 있는 깨끗한 상태\"를 만드는 게 Silver의 역할이다.\nSilver에서 하는 일, 안 하는 일 경계가 중요하다. Silver에서 비즈니스 로직을 넣기 시작하면 Bronze와 Silver를 나눈 의미가 사라진다.\nSilver에서 하는 일:\n타입 캐스팅 — VARCHAR를 DATE, INTEGER를 DECIMAL로 컬럼명 표준화 — user_id와 userId를 user_id로 통일 단위 변환 — 센트를 달러로, 밀리초를 초로 중복 제거 — 같은 레코드가 두 번 적재된 경우 NULL 처리 — 빈 문자열을 NULL로 통일 Silver에서 안 하는 일:\nKPI 계산 — 매출, 마진율 같은 비즈니스 지표 테이블 조인 — 주문과 고객을 합쳐서 하나의 뷰로 만드는 것 집계 — GROUP BY로 요약하는 것 조인과 집계는 Gold의 몫이다. Silver는 개별 테이블 단위로 정제만 한다.\ndbt가 필요한 이유 1편에서 dbt를 도구로 소개했다. 왜 SQL 파일을 직접 실행하지 않고 dbt를 쓰는가.\nSQL 파일을 하나씩 실행하면 처음엔 문제가 없다. Silver 테이블이 5개, 10개로 늘어나면 상황이 달라진다. 어떤 테이블이 어떤 Bronze 테이블에 의존하는지, 어떤 순서로 실행해야 하는지, 마지막 실행이 언제인지 추적이 안 된다.\ndbt는 이걸 해결한다. SQL 파일 하나가 하나의 모델이다. 모델 간 의존 관계를 ref() 함수로 선언하면 dbt가 실행 순서를 알아서 정한다. 변환 로직이 SQL 파일에 남으니 Git으로 이력 추적도 된다.\ndbt 프로젝트 세팅 Colab에서 dbt 프로젝트를 만든다.\n!pip install -q duckdb dbt-core dbt-duckdb import os # dbt 프로젝트 디렉토리 구조 생성 os.makedirs('jaffle_shop/models/staging', exist_ok=True) os.makedirs('jaffle_shop/models/marts', exist_ok=True) dbt 설정 파일을 만든다. DuckDB를 데이터베이스로 쓰도록 지정한다.\n%%writefile jaffle_shop/dbt_project.yml name: 'jaffle_shop' version: '1.0.0' profile: 'jaffle_shop' model-paths: [\"models\"] %%writefile jaffle_shop/profiles.yml jaffle_shop: target: dev outputs: dev: type: duckdb path: /content/warehouse.duckdb Silver 모델 작성 dbt에서는 models/staging/ 디렉토리에 Silver 레이어 모델을 둔다. stg_ 접두어가 staging(=Silver)을 뜻한다.\nstg_orders %%writefile jaffle_shop/models/staging/stg_orders.sql with source as ( select * from bronze.orders ), cleaned as ( select id as order_id, user_id as customer_id, cast(order_date as date) as order_date, status from source ) select * from cleaned Bronze의 id를 order_id로 바꿨다. 여러 테이블을 조인할 때 id만으로는 어느 테이블의 ID인지 알 수 없으니까. user_id도 customer_id로 바꿔서 의미를 명확히 했다. order_date를 DATE로 캐스팅했다.\nstg_customers %%writefile jaffle_shop/models/staging/stg_customers.sql with source as ( select * from bronze.customers ), cleaned as ( select id as customer_id, first_name, last_name from source ) select * from cleaned stg_payments %%writefile jaffle_shop/models/staging/stg_payments.sql with source as ( select * from bronze.payments ), cleaned as ( select id as payment_id, order_id, payment_method, amount / 100.0 as amount_dollars from source ) select * from cleaned amount를 100으로 나눠서 달러 단위로 바꿨다. 컬럼명도 amount_dollars로 변경해서 단위가 뭔지 이름에서 바로 읽힌다.\ndbt 실행 !cd jaffle_shop \u0026\u0026 dbt run --select staging.* dbt가 stg_orders, stg_customers, stg_payments 세 모델을 실행한다. 각각 DuckDB에 뷰로 생성된다.\n결과 확인 import duckdb conn = duckdb.connect('warehouse.duckdb') # Silver 레이어 확인 conn.execute(\"SELECT * FROM stg_orders LIMIT 5\").fetchdf() # 타입 확인 — order_date가 DATE로 바뀌었는가 conn.execute(\"\"\" SELECT column_name, data_type FROM information_schema.columns WHERE table_name = 'stg_orders' \"\"\").fetchdf() # payments의 amount가 달러 단위로 변환되었는가 conn.execute(\"SELECT * FROM stg_payments LIMIT 5\").fetchdf() Bronze에서는 VARCHAR였던 order_date가 DATE로 바뀌었다. amount가 센트에서 달러로 변환됐다. 컬럼명이 통일됐다. 이게 Silver다.\nCTE 패턴 위 SQL에서 반복적으로 쓰인 패턴이 있다. with source as (...), cleaned as (...) select * from cleaned. dbt 커뮤니티에서 널리 쓰이는 CTE(Common Table Expression) 패턴이다.\nwith source as ( -- 1단계: Bronze에서 원본을 가져온다 select * from bronze.orders ), cleaned as ( -- 2단계: 정제 로직을 적용한다 select id as order_id, cast(order_date as date) as order_date from source ) -- 3단계: 최종 결과를 반환한다 select * from cleaned source → cleaned → select. 각 단계가 뭘 하는지 이름에서 읽힌다. 정제 로직이 복잡해지면 CTE를 더 추가하면 된다. renamed, filtered, deduplicated 같은 이름으로 단계를 나누는 팀도 있다.\n중복 제거 패턴 Bronze에 같은 레코드가 두 번 들어오는 경우가 있다. 소스 시스템에서 데이터를 다시 보냈거나, 증분 적재 로직에 버그가 있었거나. Silver에서 이걸 잡아야 한다.\nwith source as ( select * from bronze.orders ), deduplicated as ( select *, row_number() over ( partition by id order by _loaded_at desc ) as row_num from source ), cleaned as ( select id as order_id, user_id as customer_id, cast(order_date as date) as order_date, status from deduplicated where row_num = 1 ) select * from cleaned row_number()로 같은 id가 여러 개 있으면 가장 최근에 적재된 것만 남긴다. 2편에서 추가한 _loaded_at 메타데이터 컬럼이 여기서 쓰인다.\nSilver를 함부로 바꾸면 Gold가 깨진다 Gold 모델은 Silver 테이블의 컬럼명, 타입, 단위를 믿고 쓴다. stg_orders의 order_date가 DATE라는 전제로 Gold에서 날짜 함수를 쓰고 있는데, 누군가 Silver에서 컬럼명을 ordered_at으로 바꾸면 Gold 모델이 전부 에러를 뱉는다.\n컬럼을 추가하는 건 괜찮다. 기존 컬럼의 이름이나 타입을 바꾸는 게 위험하다. dbt의 ref() 함수가 의존 관계를 추적하니까 어디가 영향 받는지는 확인할 수 있다.\n실무 참고: Airflow에서 dbt 실행 Airflow에서 dbt를 실행하는 방법은 여러 가지다. 가장 간단한 건 BashOperator로 dbt run을 호출하는 것이고, 더 정교하게 하려면 cosmos 라이브러리를 쓴다.\nfrom airflow import DAG from airflow.operators.bash import BashOperator from datetime import datetime with DAG( dag_id='silver_transformation', schedule='0 6 * * *', start_date=datetime(2026, 1, 1), catchup=False, ) as dag: # Bronze 적재 완료를 기다린 뒤 Silver 변환 실행 run_staging = BashOperator( task_id='dbt_run_staging', bash_command='cd /opt/dbt/jaffle_shop \u0026\u0026 dbt run --select staging', ) # dbt test로 Silver 데이터 품질 검증 test_staging = BashOperator( task_id='dbt_test_staging', bash_command='cd /opt/dbt/jaffle_shop \u0026\u0026 dbt test --select staging', ) run_staging \u003e\u003e test_staging dbt run 다음에 dbt test를 건다. Silver 변환이 끝나면 바로 품질 검증을 돌린다. 테스트가 실패하면 Gold 변환으로 넘어가지 않는다. 불량 데이터가 Gold까지 올라가는 걸 막는 구조다.\ncosmos 라이브러리를 쓰면 dbt 모델 하나하나를 Airflow 태스크로 분리할 수 있다. stg_orders가 실패해도 stg_customers는 독립적으로 성공 처리된다. 모델이 수십 개로 늘어나면 이 세분화가 의미 있어진다.\n다음 글에서는 SCD(Slowly Changing Dimension)를 다룬다. 고객의 주소가 바뀌었을 때 과거 주소를 어떻게 보존하는가. Type 1, 2, 3의 차이와 선택 기준.\nGoogle Colab에서 실습하기\r","wordCount":"982","inLanguage":"en","datePublished":"2026-02-22T00:00:00Z","dateModified":"2026-02-22T00:00:00Z","author":{"@type":"Person","name":"Junho Lee"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://biz-agentic-ai.github.io/guides/etl-design/003-silver-layer/"},"publisher":{"@type":"Person","name":"Junho Lee | DataNexus 구축 과정","logo":{"@type":"ImageObject","url":"https://biz-agentic-ai.github.io/favicon.svg"}}}</script></head><body id=top><script data-goatcounter=https://biz-agentic-ai.goatcounter.com/count async src=//gc.zgo.at/count.js></script><aside class=sidebar id=sidebar><div class=sidebar-inner><div class=sidebar-header><a href=https://biz-agentic-ai.github.io/ class=sidebar-logo><img src=/images/DataNexus_Logo.jpg alt=DataNexus class=sidebar-logo-img>
DataNexus
</a><span class=sidebar-subtitle>구축 과정</span></div><div class=sidebar-section><h3 class=sidebar-section-title>DataNexus Series</h3><ul><li><a href=https://biz-agentic-ai.github.io/posts/datanexus/004-skos-compatibility-layer/ title="4. SKOS 호환 레이어를 왜 넣었는가">4. SKOS 호환 레이어를 왜 넣었는가</a></li><li><a href=https://biz-agentic-ai.github.io/posts/datanexus/003-datahub-glossary-as-ontology/ title="3. DataHub Glossary를 온톨로지로 쓸 수 있을까">3. DataHub Glossary를 온톨로지로 쓸 수 있을까</a></li><li><a href=https://biz-agentic-ai.github.io/posts/datanexus/002-architecture-decisions/ title="2. 4개의 오픈소스를 이 조합으로 결정하기까지">2. 4개의 오픈소스를 이 조합으로 결정하기까지</a></li><li><a href=https://biz-agentic-ai.github.io/posts/datanexus/001-why-datanexus/ title="1. 왜 DataNexus를 만드는가">1. 왜 DataNexus를 만드는가</a></li></ul></div><div class=sidebar-stats id=sidebar-stats><div class=sidebar-stat-pill id=gc-container-pv style=display:none><span class="stat-dot stat-dot--pv"></span>
<span class=sidebar-stat-value id=gc-value-pv>-</span>
<span class=sidebar-stat-label>views</span></div><div class=sidebar-stat-pill id=gc-container-uv style=display:none><span class="stat-dot stat-dot--uv"></span>
<span class=sidebar-stat-value id=gc-value-uv>-</span>
<span class=sidebar-stat-label>visitors</span></div></div><script>(function(){var e=encodeURIComponent(location.pathname);fetch("https://biz-agentic-ai.goatcounter.com/counter/"+e+".json").then(function(e){return e.json()}).then(function(e){e.count&&(document.getElementById("gc-value-pv").textContent=e.count,document.getElementById("gc-container-pv").style.display=""),e.count_unique&&(document.getElementById("gc-value-uv").textContent=e.count_unique,document.getElementById("gc-container-uv").style.display="")}).catch(function(){})})()</script><div class=sidebar-dashboard-links id=dashboard-links><a href=https://biz-agentic-ai.goatcounter.com/ target=_blank rel=noopener><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
GoatCounter
</a><a href=https://analytics.google.com/analytics/web/ target=_blank rel=noopener><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 118 2.83"/><path d="M22 12A10 10 0 0012 2v10z"/></svg>
GA4 Dashboard</a></div><script>(function(){var e=document.getElementById("dashboard-links"),t=document.getElementById("sidebar-stats");localStorage.getItem("dn-admin")&&(e.classList.add("visible"),t.classList.add("visible")),document.querySelector(".sidebar-logo").addEventListener("dblclick",function(){var n=localStorage.getItem("dn-admin");n?(localStorage.removeItem("dn-admin"),e.classList.remove("visible"),t.classList.remove("visible")):(localStorage.setItem("dn-admin","1"),e.classList.add("visible"),t.classList.add("visible"))})})()</script></div></aside><button class=sidebar-toggle id=sidebar-toggle aria-label="Toggle sidebar">
<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class=sidebar-overlay id=sidebar-overlay></div><div class=site-wrapper><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://biz-agentic-ai.github.io/ accesskey=h title="Junho Lee | DataNexus 구축 과정 (Alt + H)">Junho Lee | DataNexus 구축 과정</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://biz-agentic-ai.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://biz-agentic-ai.github.io/guides/ title=Guides><span>Guides</span></a></li><li><a href=https://biz-agentic-ai.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://biz-agentic-ai.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://biz-agentic-ai.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://biz-agentic-ai.github.io/>홈</a>&nbsp;»&nbsp;<a href=https://biz-agentic-ai.github.io/guides/>기술 가이드</a>&nbsp;»&nbsp;<a href=https://biz-agentic-ai.github.io/guides/etl-design/>ETL 설계</a></div><h1 class="post-title entry-hint-parent">3. Silver 레이어 - Bronze를 분석 가능한 상태로 올린다</h1><div class=post-meta><span title='2026-02-22 00:00:00 +0000 UTC'>February 22, 2026</span>&nbsp;·&nbsp;5 분&nbsp;·&nbsp;Junho Lee</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>목차</span></summary><div class=inner><ul><li><a href=#bronze-%eb%8d%b0%ec%9d%b4%ed%84%b0%eb%a5%bc-%eb%b0%94%eb%a1%9c-%ec%93%b0%eb%a9%b4-%ec%83%9d%ea%b8%b0%eb%8a%94-%ec%9d%bc aria-label="Bronze 데이터를 바로 쓰면 생기는 일">Bronze 데이터를 바로 쓰면 생기는 일</a></li><li><a href=#silver%ec%97%90%ec%84%9c-%ed%95%98%eb%8a%94-%ec%9d%bc-%ec%95%88-%ed%95%98%eb%8a%94-%ec%9d%bc aria-label="Silver에서 하는 일, 안 하는 일">Silver에서 하는 일, 안 하는 일</a></li><li><a href=#dbt%ea%b0%80-%ed%95%84%ec%9a%94%ed%95%9c-%ec%9d%b4%ec%9c%a0 aria-label="dbt가 필요한 이유">dbt가 필요한 이유</a></li><li><a href=#dbt-%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-%ec%84%b8%ed%8c%85 aria-label="dbt 프로젝트 세팅">dbt 프로젝트 세팅</a></li><li><a href=#silver-%eb%aa%a8%eb%8d%b8-%ec%9e%91%ec%84%b1 aria-label="Silver 모델 작성">Silver 모델 작성</a><ul><li><a href=#stg_orders aria-label=stg_orders>stg_orders</a></li><li><a href=#stg_customers aria-label=stg_customers>stg_customers</a></li><li><a href=#stg_payments aria-label=stg_payments>stg_payments</a></li></ul></li><li><a href=#dbt-%ec%8b%a4%ed%96%89 aria-label="dbt 실행">dbt 실행</a></li><li><a href=#%ea%b2%b0%ea%b3%bc-%ed%99%95%ec%9d%b8 aria-label="결과 확인">결과 확인</a></li><li><a href=#cte-%ed%8c%a8%ed%84%b4 aria-label="CTE 패턴">CTE 패턴</a></li><li><a href=#%ec%a4%91%eb%b3%b5-%ec%a0%9c%ea%b1%b0-%ed%8c%a8%ed%84%b4 aria-label="중복 제거 패턴">중복 제거 패턴</a></li><li><a href=#silver%eb%a5%bc-%ed%95%a8%eb%b6%80%eb%a1%9c-%eb%b0%94%ea%be%b8%eb%a9%b4-gold%ea%b0%80-%ea%b9%a8%ec%a7%84%eb%8b%a4 aria-label="Silver를 함부로 바꾸면 Gold가 깨진다">Silver를 함부로 바꾸면 Gold가 깨진다</a></li><li><a href=#%ec%8b%a4%eb%ac%b4-%ec%b0%b8%ea%b3%a0-airflow%ec%97%90%ec%84%9c-dbt-%ec%8b%a4%ed%96%89 aria-label="실무 참고: Airflow에서 dbt 실행">실무 참고: Airflow에서 dbt 실행</a></li></ul></div></details></div><div class=post-content><div style="margin:1.2em 0"><a href=https://colab.research.google.com/github/biz-agentic-ai/biz-agentic-ai.github.io/blob/main/notebooks/etl-003-silver-layer.ipynb target=_blank rel="noopener noreferrer" style="display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:linear-gradient(135deg,#f9ab00 0%,#f57c00 100%);color:#fff;text-decoration:none;border-radius:8px;font-weight:600;font-size:.95em;box-shadow:0 2px 8px rgba(245,124,0,.25);transition:all .2s ease"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#fff"/></svg>
Google Colab에서 실습하기</a></div><h2 id=bronze-데이터를-바로-쓰면-생기는-일>Bronze 데이터를 바로 쓰면 생기는 일<a hidden class=anchor aria-hidden=true href=#bronze-데이터를-바로-쓰면-생기는-일>#</a></h2><p><a href=https://biz-agentic-ai.github.io/guides/etl-design/002-bronze-layer/>2편</a>에서 Bronze에 원본을 있는 그대로 적재했다. 변환 없이. 그 원칙은 맞다. 문제는 Bronze 데이터가 분석에 쓸 수 있는 상태가 아니라는 것이다.</p><p>jaffle_shop의 <code>bronze.orders</code>를 보자. <code>order_date</code> 컬럼이 VARCHAR로 들어와 있다. 날짜 함수를 쓸 수 없다. <code>status</code> 컬럼에는 <code>returned</code>, <code>return_pending</code>, <code>completed</code>, <code>placed</code>, <code>shipped</code>가 섞여 있는데, 어느 값이 최종 상태인지 스키마만 봐서는 모른다.</p><p><code>bronze.payments</code>의 <code>amount</code> 컬럼은 센트 단위 정수다. 달러로 바꾸려면 100으로 나눠야 한다. 이걸 분석할 때마다 매번 나누는 건 실수를 부르는 구조다.</p><p>Silver는 이런 문제를 한 번에 정리하는 레이어다. 타입을 맞추고, 컬럼명을 통일하고, 단위를 변환한다. 비즈니스 로직은 아직 넣지 않는다. &ldquo;분석에 쓸 수 있는 깨끗한 상태"를 만드는 게 Silver의 역할이다.</p><h2 id=silver에서-하는-일-안-하는-일>Silver에서 하는 일, 안 하는 일<a hidden class=anchor aria-hidden=true href=#silver에서-하는-일-안-하는-일>#</a></h2><p>경계가 중요하다. Silver에서 비즈니스 로직을 넣기 시작하면 Bronze와 Silver를 나눈 의미가 사라진다.</p><p><strong>Silver에서 하는 일:</strong></p><ul><li>타입 캐스팅 — VARCHAR를 DATE, INTEGER를 DECIMAL로</li><li>컬럼명 표준화 — <code>user_id</code>와 <code>userId</code>를 <code>user_id</code>로 통일</li><li>단위 변환 — 센트를 달러로, 밀리초를 초로</li><li>중복 제거 — 같은 레코드가 두 번 적재된 경우</li><li>NULL 처리 — 빈 문자열을 NULL로 통일</li></ul><p><strong>Silver에서 안 하는 일:</strong></p><ul><li>KPI 계산 — 매출, 마진율 같은 비즈니스 지표</li><li>테이블 조인 — 주문과 고객을 합쳐서 하나의 뷰로 만드는 것</li><li>집계 — GROUP BY로 요약하는 것</li></ul><p>조인과 집계는 Gold의 몫이다. Silver는 개별 테이블 단위로 정제만 한다.</p><h2 id=dbt가-필요한-이유>dbt가 필요한 이유<a hidden class=anchor aria-hidden=true href=#dbt가-필요한-이유>#</a></h2><p><a href=https://biz-agentic-ai.github.io/guides/etl-design/001-medallion-architecture/>1편</a>에서 dbt를 도구로 소개했다. 왜 SQL 파일을 직접 실행하지 않고 dbt를 쓰는가.</p><p>SQL 파일을 하나씩 실행하면 처음엔 문제가 없다. Silver 테이블이 5개, 10개로 늘어나면 상황이 달라진다. 어떤 테이블이 어떤 Bronze 테이블에 의존하는지, 어떤 순서로 실행해야 하는지, 마지막 실행이 언제인지 추적이 안 된다.</p><p>dbt는 이걸 해결한다. SQL 파일 하나가 하나의 모델이다. 모델 간 의존 관계를 <code>ref()</code> 함수로 선언하면 dbt가 실행 순서를 알아서 정한다. 변환 로직이 SQL 파일에 남으니 Git으로 이력 추적도 된다.</p><h2 id=dbt-프로젝트-세팅>dbt 프로젝트 세팅<a hidden class=anchor aria-hidden=true href=#dbt-프로젝트-세팅>#</a></h2><p>Colab에서 dbt 프로젝트를 만든다.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#db4b4b>!</span>pip install <span style=color:#9ece6a;font-weight:700>-</span>q duckdb dbt<span style=color:#9ece6a;font-weight:700>-</span>core dbt<span style=color:#9ece6a;font-weight:700>-</span>duckdb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7dcfff>import</span> <span style=color:#e0af68>os</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># dbt 프로젝트 디렉토리 구조 생성</span>
</span></span><span style=display:flex><span>os<span style=color:#9ece6a;font-weight:700>.</span>makedirs(<span style=color:#9ece6a>&#39;jaffle_shop/models/staging&#39;</span>, exist_ok<span style=color:#9ece6a;font-weight:700>=</span><span style=color:#e0af68>True</span>)
</span></span><span style=display:flex><span>os<span style=color:#9ece6a;font-weight:700>.</span>makedirs(<span style=color:#9ece6a>&#39;jaffle_shop/models/marts&#39;</span>, exist_ok<span style=color:#9ece6a;font-weight:700>=</span><span style=color:#e0af68>True</span>)
</span></span></code></pre></div><p>dbt 설정 파일을 만든다. DuckDB를 데이터베이스로 쓰도록 지정한다.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#9ece6a;font-weight:700>%%</span>writefile jaffle_shop<span style=color:#9ece6a;font-weight:700>/</span>dbt_project<span style=color:#9ece6a;font-weight:700>.</span>yml
</span></span><span style=display:flex><span>name: <span style=color:#9ece6a>&#39;jaffle_shop&#39;</span>
</span></span><span style=display:flex><span>version: <span style=color:#9ece6a>&#39;1.0.0&#39;</span>
</span></span><span style=display:flex><span>profile: <span style=color:#9ece6a>&#39;jaffle_shop&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>model<span style=color:#9ece6a;font-weight:700>-</span>paths: [<span style=color:#9ece6a>&#34;models&#34;</span>]
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#9ece6a;font-weight:700>%%</span>writefile jaffle_shop<span style=color:#9ece6a;font-weight:700>/</span>profiles<span style=color:#9ece6a;font-weight:700>.</span>yml
</span></span><span style=display:flex><span>jaffle_shop:
</span></span><span style=display:flex><span>  target: dev
</span></span><span style=display:flex><span>  outputs:
</span></span><span style=display:flex><span>    dev:
</span></span><span style=display:flex><span>      <span style=color:#9ece6a>type</span>: duckdb
</span></span><span style=display:flex><span>      path: <span style=color:#9ece6a;font-weight:700>/</span>content<span style=color:#9ece6a;font-weight:700>/</span>warehouse<span style=color:#9ece6a;font-weight:700>.</span>duckdb
</span></span></code></pre></div><h2 id=silver-모델-작성>Silver 모델 작성<a hidden class=anchor aria-hidden=true href=#silver-모델-작성>#</a></h2><p>dbt에서는 <code>models/staging/</code> 디렉토리에 Silver 레이어 모델을 둔다. <code>stg_</code> 접두어가 staging(=Silver)을 뜻한다.</p><h3 id=stg_orders>stg_orders<a hidden class=anchor aria-hidden=true href=#stg_orders>#</a></h3><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#9ece6a;font-weight:700>%%</span>writefile jaffle_shop<span style=color:#9ece6a;font-weight:700>/</span>models<span style=color:#9ece6a;font-weight:700>/</span>staging<span style=color:#9ece6a;font-weight:700>/</span>stg_orders<span style=color:#9ece6a;font-weight:700>.</span>sql
</span></span><span style=display:flex><span><span style=color:#bb9af7>with</span> source <span style=color:#bb9af7>as</span> (
</span></span><span style=display:flex><span>    select <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#7dcfff>from</span> <span style=color:#e0af68>bronze.orders</span>
</span></span><span style=display:flex><span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cleaned <span style=color:#bb9af7>as</span> (
</span></span><span style=display:flex><span>    select
</span></span><span style=display:flex><span>        <span style=color:#9ece6a>id</span> <span style=color:#bb9af7>as</span> order_id,
</span></span><span style=display:flex><span>        user_id <span style=color:#bb9af7>as</span> customer_id,
</span></span><span style=display:flex><span>        cast(order_date <span style=color:#bb9af7>as</span> date) <span style=color:#bb9af7>as</span> order_date,
</span></span><span style=display:flex><span>        status
</span></span><span style=display:flex><span>    <span style=color:#7dcfff>from</span> <span style=color:#e0af68>source</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>select <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#7dcfff>from</span> <span style=color:#e0af68>cleaned</span>
</span></span></code></pre></div><p>Bronze의 <code>id</code>를 <code>order_id</code>로 바꿨다. 여러 테이블을 조인할 때 <code>id</code>만으로는 어느 테이블의 ID인지 알 수 없으니까. <code>user_id</code>도 <code>customer_id</code>로 바꿔서 의미를 명확히 했다. <code>order_date</code>를 DATE로 캐스팅했다.</p><h3 id=stg_customers>stg_customers<a hidden class=anchor aria-hidden=true href=#stg_customers>#</a></h3><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#9ece6a;font-weight:700>%%</span>writefile jaffle_shop<span style=color:#9ece6a;font-weight:700>/</span>models<span style=color:#9ece6a;font-weight:700>/</span>staging<span style=color:#9ece6a;font-weight:700>/</span>stg_customers<span style=color:#9ece6a;font-weight:700>.</span>sql
</span></span><span style=display:flex><span><span style=color:#bb9af7>with</span> source <span style=color:#bb9af7>as</span> (
</span></span><span style=display:flex><span>    select <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#7dcfff>from</span> <span style=color:#e0af68>bronze.customers</span>
</span></span><span style=display:flex><span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cleaned <span style=color:#bb9af7>as</span> (
</span></span><span style=display:flex><span>    select
</span></span><span style=display:flex><span>        <span style=color:#9ece6a>id</span> <span style=color:#bb9af7>as</span> customer_id,
</span></span><span style=display:flex><span>        first_name,
</span></span><span style=display:flex><span>        last_name
</span></span><span style=display:flex><span>    <span style=color:#7dcfff>from</span> <span style=color:#e0af68>source</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>select <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#7dcfff>from</span> <span style=color:#e0af68>cleaned</span>
</span></span></code></pre></div><h3 id=stg_payments>stg_payments<a hidden class=anchor aria-hidden=true href=#stg_payments>#</a></h3><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#9ece6a;font-weight:700>%%</span>writefile jaffle_shop<span style=color:#9ece6a;font-weight:700>/</span>models<span style=color:#9ece6a;font-weight:700>/</span>staging<span style=color:#9ece6a;font-weight:700>/</span>stg_payments<span style=color:#9ece6a;font-weight:700>.</span>sql
</span></span><span style=display:flex><span><span style=color:#bb9af7>with</span> source <span style=color:#bb9af7>as</span> (
</span></span><span style=display:flex><span>    select <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#7dcfff>from</span> <span style=color:#e0af68>bronze.payments</span>
</span></span><span style=display:flex><span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cleaned <span style=color:#bb9af7>as</span> (
</span></span><span style=display:flex><span>    select
</span></span><span style=display:flex><span>        <span style=color:#9ece6a>id</span> <span style=color:#bb9af7>as</span> payment_id,
</span></span><span style=display:flex><span>        order_id,
</span></span><span style=display:flex><span>        payment_method,
</span></span><span style=display:flex><span>        amount <span style=color:#9ece6a;font-weight:700>/</span> <span style=color:#e0af68>100.0</span> <span style=color:#bb9af7>as</span> amount_dollars
</span></span><span style=display:flex><span>    <span style=color:#7dcfff>from</span> <span style=color:#e0af68>source</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>select <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#7dcfff>from</span> <span style=color:#e0af68>cleaned</span>
</span></span></code></pre></div><p><code>amount</code>를 100으로 나눠서 달러 단위로 바꿨다. 컬럼명도 <code>amount_dollars</code>로 변경해서 단위가 뭔지 이름에서 바로 읽힌다.</p><h2 id=dbt-실행>dbt 실행<a hidden class=anchor aria-hidden=true href=#dbt-실행>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#db4b4b>!</span>cd jaffle_shop <span style=color:#9ece6a;font-weight:700>&amp;&amp;</span> dbt run <span style=color:#9ece6a;font-weight:700>--</span>select staging<span style=color:#9ece6a;font-weight:700>.*</span>
</span></span></code></pre></div><p>dbt가 <code>stg_orders</code>, <code>stg_customers</code>, <code>stg_payments</code> 세 모델을 실행한다. 각각 DuckDB에 뷰로 생성된다.</p><h2 id=결과-확인>결과 확인<a hidden class=anchor aria-hidden=true href=#결과-확인>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#7dcfff>import</span> <span style=color:#e0af68>duckdb</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn <span style=color:#9ece6a;font-weight:700>=</span> duckdb<span style=color:#9ece6a;font-weight:700>.</span>connect(<span style=color:#9ece6a>&#39;warehouse.duckdb&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># Silver 레이어 확인</span>
</span></span><span style=display:flex><span>conn<span style=color:#9ece6a;font-weight:700>.</span>execute(<span style=color:#9ece6a>&#34;SELECT * FROM stg_orders LIMIT 5&#34;</span>)<span style=color:#9ece6a;font-weight:700>.</span>fetchdf()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#414868;font-style:italic># 타입 확인 — order_date가 DATE로 바뀌었는가</span>
</span></span><span style=display:flex><span>conn<span style=color:#9ece6a;font-weight:700>.</span>execute(<span style=color:#9ece6a>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#9ece6a>SELECT column_name, data_type
</span></span></span><span style=display:flex><span><span style=color:#9ece6a>FROM information_schema.columns
</span></span></span><span style=display:flex><span><span style=color:#9ece6a>WHERE table_name = &#39;stg_orders&#39;
</span></span></span><span style=display:flex><span><span style=color:#9ece6a>&#34;&#34;&#34;</span>)<span style=color:#9ece6a;font-weight:700>.</span>fetchdf()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#414868;font-style:italic># payments의 amount가 달러 단위로 변환되었는가</span>
</span></span><span style=display:flex><span>conn<span style=color:#9ece6a;font-weight:700>.</span>execute(<span style=color:#9ece6a>&#34;SELECT * FROM stg_payments LIMIT 5&#34;</span>)<span style=color:#9ece6a;font-weight:700>.</span>fetchdf()
</span></span></code></pre></div><p>Bronze에서는 VARCHAR였던 <code>order_date</code>가 DATE로 바뀌었다. <code>amount</code>가 센트에서 달러로 변환됐다. 컬럼명이 통일됐다. 이게 Silver다.</p><h2 id=cte-패턴>CTE 패턴<a hidden class=anchor aria-hidden=true href=#cte-패턴>#</a></h2><p>위 SQL에서 반복적으로 쓰인 패턴이 있다. <code>with source as (...), cleaned as (...) select * from cleaned</code>. dbt 커뮤니티에서 널리 쓰이는 CTE(Common Table Expression) 패턴이다.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#bb9af7>with</span> <span style=color:#bb9af7>source</span> <span style=color:#bb9af7>as</span> (
</span></span><span style=display:flex><span>    <span style=color:#414868;font-style:italic>-- 1단계: Bronze에서 원본을 가져온다
</span></span></span><span style=display:flex><span>    <span style=color:#bb9af7>select</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#bb9af7>from</span> bronze.orders
</span></span><span style=display:flex><span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cleaned <span style=color:#bb9af7>as</span> (
</span></span><span style=display:flex><span>    <span style=color:#414868;font-style:italic>-- 2단계: 정제 로직을 적용한다
</span></span></span><span style=display:flex><span>    <span style=color:#bb9af7>select</span>
</span></span><span style=display:flex><span>        id <span style=color:#bb9af7>as</span> order_id,
</span></span><span style=display:flex><span>        <span style=color:#bb9af7>cast</span>(order_date <span style=color:#bb9af7>as</span> <span style=color:#9ece6a>date</span>) <span style=color:#bb9af7>as</span> order_date
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>from</span> <span style=color:#bb9af7>source</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic>-- 3단계: 최종 결과를 반환한다
</span></span></span><span style=display:flex><span><span style=color:#bb9af7>select</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#bb9af7>from</span> cleaned
</span></span></code></pre></div><p><code>source</code> → <code>cleaned</code> → <code>select</code>. 각 단계가 뭘 하는지 이름에서 읽힌다. 정제 로직이 복잡해지면 CTE를 더 추가하면 된다. <code>renamed</code>, <code>filtered</code>, <code>deduplicated</code> 같은 이름으로 단계를 나누는 팀도 있다.</p><h2 id=중복-제거-패턴>중복 제거 패턴<a hidden class=anchor aria-hidden=true href=#중복-제거-패턴>#</a></h2><p>Bronze에 같은 레코드가 두 번 들어오는 경우가 있다. 소스 시스템에서 데이터를 다시 보냈거나, 증분 적재 로직에 버그가 있었거나. Silver에서 이걸 잡아야 한다.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#bb9af7>with</span> <span style=color:#bb9af7>source</span> <span style=color:#bb9af7>as</span> (
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>select</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#bb9af7>from</span> bronze.orders
</span></span><span style=display:flex><span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>deduplicated <span style=color:#bb9af7>as</span> (
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>select</span>
</span></span><span style=display:flex><span>        <span style=color:#9ece6a;font-weight:700>*</span>,
</span></span><span style=display:flex><span>        row_number() over (
</span></span><span style=display:flex><span>            partition <span style=color:#bb9af7>by</span> id
</span></span><span style=display:flex><span>            <span style=color:#bb9af7>order</span> <span style=color:#bb9af7>by</span> _loaded_at <span style=color:#bb9af7>desc</span>
</span></span><span style=display:flex><span>        ) <span style=color:#bb9af7>as</span> row_num
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>from</span> <span style=color:#bb9af7>source</span>
</span></span><span style=display:flex><span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cleaned <span style=color:#bb9af7>as</span> (
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>select</span>
</span></span><span style=display:flex><span>        id <span style=color:#bb9af7>as</span> order_id,
</span></span><span style=display:flex><span>        user_id <span style=color:#bb9af7>as</span> customer_id,
</span></span><span style=display:flex><span>        <span style=color:#bb9af7>cast</span>(order_date <span style=color:#bb9af7>as</span> <span style=color:#9ece6a>date</span>) <span style=color:#bb9af7>as</span> order_date,
</span></span><span style=display:flex><span>        status
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>from</span> deduplicated
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>where</span> row_num <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>1</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb9af7>select</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#bb9af7>from</span> cleaned
</span></span></code></pre></div><p><code>row_number()</code>로 같은 <code>id</code>가 여러 개 있으면 가장 최근에 적재된 것만 남긴다. <a href=https://biz-agentic-ai.github.io/guides/etl-design/002-bronze-layer/>2편</a>에서 추가한 <code>_loaded_at</code> 메타데이터 컬럼이 여기서 쓰인다.</p><h2 id=silver를-함부로-바꾸면-gold가-깨진다>Silver를 함부로 바꾸면 Gold가 깨진다<a hidden class=anchor aria-hidden=true href=#silver를-함부로-바꾸면-gold가-깨진다>#</a></h2><p>Gold 모델은 Silver 테이블의 컬럼명, 타입, 단위를 믿고 쓴다. <code>stg_orders</code>의 <code>order_date</code>가 DATE라는 전제로 Gold에서 날짜 함수를 쓰고 있는데, 누군가 Silver에서 컬럼명을 <code>ordered_at</code>으로 바꾸면 Gold 모델이 전부 에러를 뱉는다.</p><p>컬럼을 추가하는 건 괜찮다. 기존 컬럼의 이름이나 타입을 바꾸는 게 위험하다. dbt의 <code>ref()</code> 함수가 의존 관계를 추적하니까 어디가 영향 받는지는 확인할 수 있다.</p><h2 id=실무-참고-airflow에서-dbt-실행>실무 참고: Airflow에서 dbt 실행<a hidden class=anchor aria-hidden=true href=#실무-참고-airflow에서-dbt-실행>#</a></h2><p>Airflow에서 dbt를 실행하는 방법은 여러 가지다. 가장 간단한 건 <code>BashOperator</code>로 <code>dbt run</code>을 호출하는 것이고, 더 정교하게 하려면 <code>cosmos</code> 라이브러리를 쓴다.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#7dcfff>from</span> <span style=color:#e0af68>airflow</span> <span style=color:#7dcfff>import</span> DAG
</span></span><span style=display:flex><span><span style=color:#7dcfff>from</span> <span style=color:#e0af68>airflow.operators.bash</span> <span style=color:#7dcfff>import</span> BashOperator
</span></span><span style=display:flex><span><span style=color:#7dcfff>from</span> <span style=color:#e0af68>datetime</span> <span style=color:#7dcfff>import</span> datetime
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb9af7>with</span> DAG(
</span></span><span style=display:flex><span>    dag_id<span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#39;silver_transformation&#39;</span>,
</span></span><span style=display:flex><span>    schedule<span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#39;0 6 * * *&#39;</span>,
</span></span><span style=display:flex><span>    start_date<span style=color:#9ece6a;font-weight:700>=</span>datetime(<span style=color:#e0af68>2026</span>, <span style=color:#e0af68>1</span>, <span style=color:#e0af68>1</span>),
</span></span><span style=display:flex><span>    catchup<span style=color:#9ece6a;font-weight:700>=</span><span style=color:#e0af68>False</span>,
</span></span><span style=display:flex><span>) <span style=color:#bb9af7>as</span> dag:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#414868;font-style:italic># Bronze 적재 완료를 기다린 뒤 Silver 변환 실행</span>
</span></span><span style=display:flex><span>    run_staging <span style=color:#9ece6a;font-weight:700>=</span> BashOperator(
</span></span><span style=display:flex><span>        task_id<span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#39;dbt_run_staging&#39;</span>,
</span></span><span style=display:flex><span>        bash_command<span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#39;cd /opt/dbt/jaffle_shop &amp;&amp; dbt run --select staging&#39;</span>,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#414868;font-style:italic># dbt test로 Silver 데이터 품질 검증</span>
</span></span><span style=display:flex><span>    test_staging <span style=color:#9ece6a;font-weight:700>=</span> BashOperator(
</span></span><span style=display:flex><span>        task_id<span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#39;dbt_test_staging&#39;</span>,
</span></span><span style=display:flex><span>        bash_command<span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#39;cd /opt/dbt/jaffle_shop &amp;&amp; dbt test --select staging&#39;</span>,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    run_staging <span style=color:#9ece6a;font-weight:700>&gt;&gt;</span> test_staging
</span></span></code></pre></div><p><code>dbt run</code> 다음에 <code>dbt test</code>를 건다. Silver 변환이 끝나면 바로 품질 검증을 돌린다. 테스트가 실패하면 Gold 변환으로 넘어가지 않는다. 불량 데이터가 Gold까지 올라가는 걸 막는 구조다.</p><p><code>cosmos</code> 라이브러리를 쓰면 dbt 모델 하나하나를 Airflow 태스크로 분리할 수 있다. <code>stg_orders</code>가 실패해도 <code>stg_customers</code>는 독립적으로 성공 처리된다. 모델이 수십 개로 늘어나면 이 세분화가 의미 있어진다.</p><p>다음 글에서는 SCD(Slowly Changing Dimension)를 다룬다. 고객의 주소가 바뀌었을 때 과거 주소를 어떻게 보존하는가. Type 1, 2, 3의 차이와 선택 기준.</p><div style="margin:1.2em 0"><a href=https://colab.research.google.com/github/biz-agentic-ai/biz-agentic-ai.github.io/blob/main/notebooks/etl-003-silver-layer.ipynb target=_blank rel="noopener noreferrer" style="display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:linear-gradient(135deg,#f9ab00 0%,#f57c00 100%);color:#fff;text-decoration:none;border-radius:8px;font-weight:600;font-size:.95em;box-shadow:0 2px 8px rgba(245,124,0,.25);transition:all .2s ease"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#fff"/></svg>
Google Colab에서 실습하기</a></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://biz-agentic-ai.github.io/tags/etl/>Etl</a></li><li><a href=https://biz-agentic-ai.github.io/tags/silver/>Silver</a></li><li><a href=https://biz-agentic-ai.github.io/tags/data-cleaning/>Data-Cleaning</a></li></ul><nav class=paginav><a class=prev href=https://biz-agentic-ai.github.io/guides/etl-design/002-bronze-layer/><span class=title>« 이전 페이지</span><br><span>2. Bronze 레이어 - 원본을 있는 그대로 쌓는다</span></a></nav></footer><div class=comments><script src=https://giscus.app/client.js data-repo=biz-agentic-ai/biz-agentic-ai.github.io data-repo-id=R_kgDOPhm8OQ data-category=General data-category-id=DIC_kwDOPhm8Oc4C2uES data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=ko data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2026 <a href=https://biz-agentic-ai.github.io/>Junho Lee | DataNexus 구축 과정</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="복사";function s(){t.innerHTML="복사 완료!",setTimeout(()=>{t.innerHTML="복사"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></div><script>(function(){const n=document.getElementById("sidebar-toggle"),e=document.getElementById("sidebar"),t=document.getElementById("sidebar-overlay");n&&e&&(n.addEventListener("click",function(){e.classList.toggle("open"),t.classList.toggle("open")}),t.addEventListener("click",function(){e.classList.remove("open"),t.classList.remove("open")}))})()</script></body></html>