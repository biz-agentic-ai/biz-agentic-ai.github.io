{{- $currentPage := . -}}
<script data-goatcounter="https://biz-agentic-ai.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
<aside class="sidebar" id="sidebar">
  <div class="sidebar-inner">
    {{- /* Logo / Site Title */ -}}
    <div class="sidebar-header">
      <a href="{{ "" | absLangURL }}" class="sidebar-logo">
        DataNexus
      </a>
      <span class="sidebar-subtitle">구축 과정</span>
    </div>

    {{- /* Main Menu */ -}}
    <nav class="sidebar-nav">
      <ul>
        {{- range site.Menus.main }}
        {{- $menu_item_url := (cond (strings.HasSuffix .URL "/") .URL (printf "%s/" .URL)) | absLangURL }}
        {{- $page_url := $currentPage.Permalink | absLangURL }}
        <li>
          <a href="{{ .URL | absLangURL }}"{{ if eq $menu_item_url $page_url }} class="active"{{ end }}>
            {{ .Name }}
          </a>
        </li>
        {{- end }}
      </ul>
    </nav>

    {{- /* DataNexus Series */ -}}
    {{- $series := where site.RegularPages "Section" "posts" }}
    {{- $dnPages := where $series ".File.Dir" "posts/datanexus/" }}
    {{- if $dnPages }}
    <div class="sidebar-section">
      <h3 class="sidebar-section-title">DataNexus Series</h3>
      <ul>
        {{- range $dnPages.ByDate }}
        <li>
          <a href="{{ .Permalink }}"{{ if eq .Permalink $currentPage.Permalink }} class="active"{{ end }}>
            {{ .Title }}
          </a>
        </li>
        {{- end }}
      </ul>
    </div>
    {{- end }}

    {{- /* Visitor Stats (GoatCounter) */ -}}
    <div class="sidebar-stats">
      <div class="sidebar-stat-pill" id="gc-container-pv" style="display:none;">
        <span class="stat-dot stat-dot--pv"></span>
        <span class="sidebar-stat-value" id="gc-value-pv">-</span>
        <span class="sidebar-stat-label">views</span>
      </div>
      <div class="sidebar-stat-pill" id="gc-container-uv" style="display:none;">
        <span class="stat-dot stat-dot--uv"></span>
        <span class="sidebar-stat-value" id="gc-value-uv">-</span>
        <span class="sidebar-stat-label">visitors</span>
      </div>
    </div>
    <script>
    (function() {
      var p = encodeURIComponent(location.pathname);
      fetch('https://biz-agentic-ai.goatcounter.com/counter/' + p + '.json')
        .then(function(r) { return r.json(); })
        .then(function(d) {
          if (d.count) {
            document.getElementById('gc-value-pv').textContent = d.count;
            document.getElementById('gc-container-pv').style.display = '';
          }
          if (d.count_unique) {
            document.getElementById('gc-value-uv').textContent = d.count_unique;
            document.getElementById('gc-container-uv').style.display = '';
          }
        })
        .catch(function() {});
    })();
    </script>

    {{- /* Dashboard Links (admin only) */ -}}
    <div class="sidebar-dashboard-links" id="dashboard-links">
      <a href="https://biz-agentic-ai.goatcounter.com/" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
        GoatCounter
      </a>
      <a href="https://analytics.google.com/analytics/web/" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>
        GA4 Dashboard
      </a>
    </div>
    <script>
    (function() {
      var el = document.getElementById('dashboard-links');
      if (localStorage.getItem('dn-admin')) el.classList.add('visible');
      document.querySelector('.sidebar-logo').addEventListener('dblclick', function() {
        var on = localStorage.getItem('dn-admin');
        if (on) { localStorage.removeItem('dn-admin'); el.classList.remove('visible'); }
        else { localStorage.setItem('dn-admin', '1'); el.classList.add('visible'); }
      });
    })();
    </script>

    {{- /* Theme Toggle */ -}}
    {{- if (not site.Params.disableThemeToggle) }}
    <div class="sidebar-footer">
      <button id="sidebar-theme-toggle" aria-label="Toggle theme">
        <svg id="sidebar-moon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        <svg id="sidebar-sun" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        <span>Toggle Theme</span>
      </button>
    </div>
    {{- end }}
  </div>
</aside>
{{- /* Mobile toggle button */ -}}
<button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
</button>
<div class="sidebar-overlay" id="sidebar-overlay"></div>
